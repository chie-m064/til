# [管理画面] 管理画面へのログイン機能、管理画面トップページの作成

## 概要
* ■ 管理者ユーザーと一般ユーザーを分ける
  * Users テーブルに role カラム（integer 型）を新たに設けてください。
  * role カラムの値が 0 であれば general（一般）、 1 であれば admin（管理者）となるようにしてください。
* ■ 管理画面用のログイン機能実装
  * 管理画面のログインページのレイアウトページは、app/views/layouts/admin_login.html.erb を使用すること。
  * 管理画面にログインした後のレイアウトページは、app/views/admin/layouts/application.html.erb を使用すること。
* ■ 管理画面へログインした後のダッシュボードページ実装
  * 権限が管理者では無いユーザーがログインを試みた場合、一般のログイン画面へリダイレクトされること。
  * 管理画面のヘッダー・フッター・サイドバーは指定のものを使用すること。
* ■ ルーティング 
  * 管理画面は /admin をルートとすること。
※細かい仕様に関してはテストコードを読んで必要な実装を行ってください。

## Users テーブルにrole　カラムを追加するマイグレーションファイルを作成する
```ruby
docker compose exec web rails g migration add_role_to_users role:integer
```
```ruby:config/db/migrate/xxxx_add_role_to_users.rb
class AddRoleToUsers < ActiveRecord::Migration[7.0]
  def change
   /  role カラムにはデフォルトで 0 が登録されます
    add_column :users, :role, :integer, null: false, default: 0
  end
end
```
## Userモデルにenumを定義

### enumとは
モデルの数値カラムに対して文字列による名前定義をマップすることができます。
また、データ操作用の便利なメソッドも提供してくれます。

```ruby:
class Rating < ApplicationRecord
  enum rate: { good: 0, normal: 1, bad: 2 }
       ~~~~~   ~~~~~~~~~~~~~~~~~~~~~~~~~~~
      #カラム名   #定義対象の内容のマッピング(名前: 数値)
end
```
```ruby:
class Post < ApplicationRecord
  enum status: { unpublish: 0, publish: 10 }
end
```
上記のコードでは、status カラムが定義され、unpublish（非公開）と publish（公開）という2つのステータスが定義されています。
これにより、status カラムには数値（0 または 10）が格納されますが、コード上では unpublish や publish という名前で扱うことができます。

詳しい記事
https://qiita.com/ozackiee/items/17b91e26fad58e147f2e

```ruby:app/modeles/user.rb
class User < ApplicationRecord
  ... 省略 ...
  has_many ... 省略 ...

  enum role: { general: 0, admin: 1 }

  ... 省略 ...
end
```
上記の記述で role カラム(integer)の値に応じて、そのユーザーが general（一般）か admin（管理者）が判別できるようになります。
先程のマイグレーションファイルの default: 0 によって role カラムが 0 のユーザーは general となります。

### role を　adminに変更する
コマンド上で1ユーザーのカラム情報を書き換える
→ Railsコンソールで書き換える

```ruby
# docker compose up, docker compose exec web bin/devが実行されているターミナルとは別のターミナルを用意して以下を実行してください。

$ docker compose exec web rails c

- user = User.find_by(email: 'xxxxx')   # xxxxxには、現在ログインしているユーザーのメールアドレスを記入してください。
- user.role   # 現在ログインしているユーザーの role を確認します。
- user.admin!   # 現在ログインしているユーザーの role を admin に変更します。

# 上記操作で現在ログインしているユーザーの role が admin になっているかを確認します。
- user = User.find_by(email: 'xxxxx')
- user.role
```

## 管理画面を切り出す
### routingを書く
```ruby
 namespace :admin do
    root "dashboards#index"
    resource :dashboard, only: %i[index]
    get 'login' => 'user_sessions#new', :as => :login
    post 'login' => "user_sessions#create"
    delete 'logout' => 'user_sessions#destroy', :as => :logout
  end
```
### ルーティングの種類
https://qiita.com/senou/items/f1491e53450cb347606b
https://qiita.com/ryosuketter/items/9240d8c2561b5989f049
### namespace
コントローラーをグループ化することができる
ユーザーが使う部分と管理者が使う部分をそれぞれ分けれる







































