# パスワードリセット機能の実装

## 概要
* gem 'sorcery'のreset_password（submodules）を使ったパスワードリセット機能実装。
  * パスワードリセット申請時に「パスワードリセット手順を送信しました」と表示されること。
  * 存在しないメールアドレスからのパスワードリセット申請時にも「パスワードリセット手順を送信しました」と表示されること。
  * パスワードリセット申請を行うと、ログインページへリダイレクトされること。
  * 送信されるメール：
    * 差し出し元（from）は from@example.com であること。
    * 件名は「パスワードリセット」であること。
    * app/mailers/user_mailer.rbのreset_password_emailメソッドでパスワードリセットメールが送信されること。
  * パスワードリセット申請画面の送信ボタンは「送信」であること。
  * パスワードリセット画面の送信ボタンは「更新」であること。
* gem 'letter_opener', '2.0.0'を使った開発環境でのメール確認。
* gem 'config'を使った設定管理。

## gem 'letter_opener_web'
gem 'letter_opener_web'は、Railsアプリケーションの開発環境において、送信されるメールをブラウザで確認できるgemです。

メールの送信処理が実行されると、メールの内容がブラウザ上で表示され、実際にメールが送信されることなく内容を確認することができます。
これにより、メールの内容やフォーマットを簡単に確認・修正することが可能となります。

 letter_opener はリモートで開発していると使えないことが、、、
 例えば Mac の iTerm から Linux サーバにリモート接続して、ブラウザが Mac にある場合。letter_opener はリモート先の Linux でメールを開いている。なので見えない。
そんな時は letter_opener_web が便利。
デフォルトでは localhost:3000/letter_opener/ にアクセスすることで（画像を表示）な感じで見ることができます。

```ruby:config/routes.rb
Rails.application.routes.draw do
   mount LetterOpenerWeb::Engine, at: "/letter_opener" if Rails.env.development?

  # 後略　そのほかに設定したさまざまなルーティング
end
```
```ruby:config/environments/development.rb
require "active_support/core_ext/integer/time"

Rails.application.configure do
  ... 省略 ...
  config.action_mailer.default_url_options = { host: 'localhost:3000' }
end
```
```ruby:config/environments/test.rb
require "active_support/core_ext/integer/time"

Rails.application.configure do
  ... 省略 ...
  config.action_mailer.default_url_options = { host: 'localhost:3000' }
end
```
## モジュールの導入
```ruby
$ rails g sorcery:install reset_password --only-submodules
```
自動でマイグレートファイルが生成されるので
```ruby
$ bundle exec rails db:migrate
```
## バリデーションを追加
```ruby:
class User < ApplicationRecord
<省略>

validates :reset_password_token, uniqueness: true, allow_nil: true

<省略>
```
